<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.165">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Andrés Gutiérrez - Stalyn Guerrero - Gabriel Nieto">

<title>Estimación de uso de métodos de planificación familiar empleando modelos de unidad</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="5.0Modelo unidad UNFPA_files/libs/clipboard/clipboard.min.js"></script>
<script src="5.0Modelo unidad UNFPA_files/libs/quarto-html/quarto.js"></script>
<script src="5.0Modelo unidad UNFPA_files/libs/quarto-html/popper.min.js"></script>
<script src="5.0Modelo unidad UNFPA_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="5.0Modelo unidad UNFPA_files/libs/quarto-html/anchor.min.js"></script>
<link href="5.0Modelo unidad UNFPA_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="5.0Modelo unidad UNFPA_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="5.0Modelo unidad UNFPA_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="5.0Modelo unidad UNFPA_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="5.0Modelo unidad UNFPA_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="5.0Modelo unidad UNFPA_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="5.0Modelo unidad UNFPA_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Estimación de uso de métodos de planificación familiar empleando modelos de unidad</h1>
<p class="subtitle lead">CEPAL - División de Estadísticas Sociales</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Andrés Gutiérrez - Stalyn Guerrero - Gabriel Nieto </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<section id="introducción" class="level1">
<h1>Introducción</h1>
<p>Para los gobiernos y las organizaciones internacionales es muy importante conocer las condiciones de calidad de vida de las personas en lo que incluye la salud, por lo cual, evaluar la capacidad que estas tienen para cubrir sus necesidades de planificación familiar y de acceso a diferentes métodos modernos de planificicación; es fundamental para el diseño y formulación de políticas públicas. Por esta razón, el realizar mapas de uso de métodos de planificación familiar mediante metodologías adecuadas que permitan llegar a estimaciones precisas, se convierte en una herramienta preciada para identificar no solamente las áreas geográficas más vulnerables en términos salud sexual y reproductiva (departamentos, regiones, municipios, provincias, comunas o la división geográfica característica de cada país) sino también la situación de grupos o segmentos poblacionales de interés.</p>
<p>La Encuesta Demográfica y de Salud Familiar (ENDES 2020) es una de las investigaciones estadísticas más importantes que se realizan en Perú por cuenta del INEI, la cual se ejecuta de manera anual. Este insumo, permite la estimación a nivel nacional, departamental y por zona (urbano/rural) de múltiples indicadores demográficos en el país, relacionados con diversos aspectos de la salud, principalmente en mujeres y niños, como lactancia, mortalidad infantil, fertilidad y uso de métodos anticonceptivos, entre otros temas relevantes de salud pública.</p>
<p>Esta encuesta según el INEI, fue aplicada durante los meses de enero a diciembre del 2020. El número de viviendas seleccionadas fue 37.390 de las cuales 35.847 fueron entrevistadas. En las viviendas entrevistadas, fueron encontradas un total de 37.895 mujeres elegibles de 12 a 49 años de edad, de las cuales se obtuvo un total de 35.430 entrevistas completas. La muestra seleccionada representa la totalidad de la población del país. Es importante señalar, que para algunos de los indicadores, fueron incluidas mujeres de 12 a 49 años, el estudio se basa principalmente en mujeres entre los 15 y 49 años de edad.</p>
<section id="definiciones-de-los-indicadores-de-interés." class="level2">
<h2 class="anchored" data-anchor-id="definiciones-de-los-indicadores-de-interés.">Definiciones de los indicadores de interés.</h2>
<ul>
<li><p>Indicador D6 métodos de planificación</p>
<p>Este indicador, alude a la tasa de prevalencia de uso de métodos anticonceptivos de mujeres sin importar el tipo de método ya sea moderno, tradicional o folclórico, la cual se compone por mujeres en edad fértil (entre 15 y 49 años) y sexualmente activas</p></li>
<li><p>Indicador D6m métodos modernos de planificación</p>
<p>Este indicador, corresponde a la tasa de prevalencia que hace referencia al uso de métodos anticonceptivos de tipo moderno. la cual se compone por mujeres por mujeres en edad fértil (entre 15 y 49 años), sexualmente activas que hacen uso de algún método de tipo moderno.</p></li>
<li><p>Indicador NI necesidades insatisfechas</p>
<p>La definición de este indicador, se entiende como la tasa de prevalencia de mujeres en edad de procrear que por algún motivo no son capaces de cubrir sus necesidades de planificación familiar con algún método anticonceptivo (moderno o tradicional). Esta se compone, por mujeres en edad fértil (entre 15 a 49 años), sexualmente activas y/o unidas que afirma no ser capaces de cubrir sus necesidades de planificación familiar con algún método anticonceptivo (tradicional y/o modernos)</p></li>
<li><p>D7 (junto con necesidades insatisfechas)</p>
<p>Este indicador, hace referencia a la proporción de mujeres en edad de procrear (15 a 49 años), sexualmente activas y/o unidas que han decidido por voluntad propia no tener hijos (adicionales) o posponer su siguiente hijo y para ello se encuentran utilizando métodos anticonceptivos modernos.</p></li>
</ul>
</section>
</section>
<section id="modelo-mrp" class="level1">
<h1>Modelo MRP</h1>
<p>De acuerdo con este modelo, como lo expone Gutiérrez y otros (2022), la probabilidad de hacer uso de métodos de planificación para la <span class="math inline">\(i\)</span>-ésima persona en el <span class="math inline">\(j\)</span>-ésimo post-estrato, puede ser definido para cada unidad de la encuesta. El modelo pretende establecer la relación entre la expectativa <span class="math inline">\(\rho_{di}\)</span> de la variable dicotómica con las covariables de información auxiliar disponibles para ser incluidas. El procedimiento correspondiente a este proceso, modela el logaritmo del cociente entre la probabilidad de usar algún método anticonceptivo a su complemento en relación al conjunto de covariables a nivel de unidad, <span class="math inline">\(x_{ji}\)</span>, y el conjunto de covariables a nivel departamental, <span class="math inline">\(Z_d\)</span></p>
<p><span class="math display">\[
\ln(\frac{ρ_{ji}}{1-ρ_{ji}} ) = x_{ji}^t \beta + z_d \gamma.
\]</span></p>
<p>Los coeficientes <span class="math inline">\(\beta\)</span> hacen referencia a los efectos aleatorios de las variables <span class="math inline">\(x_{ji}^t\)</span> sobre las probabilidades de que la <span class="math inline">\(i\)</span>-ésima persona haga uso de métodos anticonceptivos; por otro lado, los coeficientes <span class="math inline">\(\gamma\)</span> expresan los efectos fijos sobre las covariables a nivel departamental, <span class="math inline">\(z_d\)</span>. Ahora, es posible asumir distribuciones no informativas para <span class="math inline">\(\beta\)</span> y <span class="math inline">\(\gamma\)</span>.</p>
<p><span class="math display">\[
\begin{eqnarray*}
\beta  &amp; \sim &amp; N(0,\sigma^2_1) \\
\gamma &amp; \sim &amp; N(0,\sigma^2_2)
\end{eqnarray*}
\]</span></p>
<section id="estandarización-de-la-encuesta" class="level2">
<h2 class="anchored" data-anchor-id="estandarización-de-la-encuesta">Estandarización de la encuesta</h2>
<p>Se presentan las variables provenientes de la Encuesta Demográfica y de Salud Familiar – ENDES, que fueron empleadas para la construcción de los datos que son utilizadas en este estudio e incluidas en el ajuste del modelo.</p>
<section id="covariables" class="level4">
<h4 class="anchored" data-anchor-id="covariables">Covariables</h4>
<div class="cell" data-layout-align="center" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-1_6a48f10a3e9f2f7d0957f8cb8c5bdf11">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="0Recursos/0Imagenes/UNFPA_cov1.png" width="800" height="650" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-2_6c8747afc95163f2eb58e8d8d72d90bf">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="0Recursos/0Imagenes/UNFPA_cov2.png" width="800" height="650" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="indicadores" class="level4">
<h4 class="anchored" data-anchor-id="indicadores">Indicadores</h4>
<div class="cell" data-layout-align="center" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-3_ffdeadef4d8646ef95c35dc5595261f1">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="0Recursos/0Imagenes/UNFPA_Indicadores.png" width="800" height="650" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>El indicador de necesidades satisfechas de planificación por métodos modernos (D7) no se crea a partir de las variables originales de la encuesta, ya que es una razón entre los otros tres indicadores creados</p>
</section>
<section id="variables-para-el-diseño-muestral" class="level4">
<h4 class="anchored" data-anchor-id="variables-para-el-diseño-muestral">Variables para el diseño muestral</h4>
<ul>
<li><p>Unidad primaria de muestreo - UPM</p>
<p>Para la definifición de esta variable, se emplea la variable original de la encuesta “V021”.</p></li>
<li><p>Estrato</p>
<p>Para la definifición de esta variable, se emplea la variable original de la encuesta “V022”.</p></li>
<li><p>Factor de expansión - fexp</p>
<p>El factor de expansión para el cual se emplea la variable original “V005” el cual requiere que al valor de la variable se le multiplique una constante (7.845.787) la cual hace referencia al número de mujeres en edad fértil; y, a ese valor se divide por la suma de la variable(V005).</p></li>
</ul>
<p>La tabla resultante se muestra en la siguiente tabla.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-4_3e4a98fdf3fccabd03dc3984a13272c9">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>encuesta_mrp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/UNFPA/D6/encuesta_mrp.rds"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>(encuesta_mrp <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> mpio </th>
   <th style="text-align:right;"> usametodo </th>
   <th style="text-align:right;"> usamoderno </th>
   <th style="text-align:right;"> necesInst </th>
   <th style="text-align:left;"> area </th>
   <th style="text-align:left;"> edad </th>
   <th style="text-align:left;"> etnia </th>
   <th style="text-align:left;"> anoest </th>
   <th style="text-align:left;"> discapacidad </th>
   <th style="text-align:left;"> unida </th>
   <th style="text-align:right;"> upm </th>
   <th style="text-align:right;"> estrato </th>
   <th style="text-align:right;"> fexp </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 24.3593 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 24.3593 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 24.3593 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 24.3593 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 24.3593 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 125.7127 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 24.3593 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 125.7127 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 24.3593 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 5 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 117.3695 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
</section>
<section id="censos-de-población-y-vivienda" class="level2">
<h2 class="anchored" data-anchor-id="censos-de-población-y-vivienda">Censos de población y vivienda</h2>
<p>Es necesario definir las variables del país con los que se desea trabajar. De acuerdo a esto, como primer paso se debe tener acceso al censo del país, para ello puede acceder desde el siguiente enlace <a href="https://redatam.org/en/microdata" class="uri">https://redatam.org/en/microdata</a> en el cual dispondrá de un archivo <em>.zip</em> con los microdatos del país. Ahora bien, para leer el conjunto de datos, es necesario emplear la función redatam.open de la librería <code>redatam</code>, la cual depende directamente del diccionario censal del software REDATAM, este es un archivo con extensión dicx y que debe encontrarse en la carpeta sobre los datos que se están leyendo. Así, es como se crea un objeto dentro de <code>R</code> que hace la respectiva unión del diccionario con los microdatos de la base de datos censal. La siguiente sintaxis muestra la lectura del diccionario en <code>R</code> y los cálculos iniciales</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-5_85c500a16679a5f2b20a8c4a9334a210">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(redatam)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>peru <span class="ot">&lt;-</span>  <span class="fu">redatam.open</span>( <span class="st">"../Data/UNFPA/1.D6/Data/cpv2017per-cde.dicx"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>CONTEOS <span class="ot">&lt;-</span> <span class="fu">redatam.query</span>(peru, <span class="st">"freq PROVINCI.REDCODEN   </span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="st">                                  by VIVIENDA.VAREA  </span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="st">                                  by PERSONA.C5P041  </span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="st">                                  by PERSONA.C5P02   </span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="st">                                  by PERSONA.EDUCA</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="st">                                  by PERSONA.UnidasR</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="st">                                  by PERSONA.P09DISC</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="st">                                  by PERSONA.PBLOPER"</span>, <span class="at">tot.omit =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Eliminando totales de la tabla</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>CONTEOS2 <span class="ot">&lt;-</span> CONTEOS <span class="sc">%&gt;%</span> <span class="fu">filter_at</span>(<span class="fu">vars</span>(<span class="fu">matches</span>(<span class="st">"_label"</span>)),<span class="fu">all_vars</span>(. <span class="sc">!=</span>  <span class="st">"__tot__"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Después de realizar algunas validaciones se estandarizan las variables como muestra el siguiente código.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-6_8c5445afcbd5d6a92e70fe33eebe1c9f">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>censo_mrp <span class="ot">&lt;-</span> CONTEOS2 <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">mpio =</span> <span class="fu">str_pad</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">string =</span> REDCODEN1_value,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad =</span> <span class="st">"0"</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">area =</span> <span class="fu">case_when</span>(VAREA2_value <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"1"</span>, <span class="co"># 1 = Urbana</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                   <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"0"</span>),    <span class="co"># 0 = Rural</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">sexo =</span> <span class="fu">as.character</span>(C5P024_value),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">edad =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    C5P0413_value <span class="sc">%in%</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">14</span> <span class="sc">~</span>  <span class="st">"1"</span>,       <span class="co"># 5 a 14</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    C5P0413_value <span class="sc">%in%</span> <span class="dv">15</span><span class="sc">:</span><span class="dv">20</span> <span class="sc">~</span> <span class="st">"2"</span>,      <span class="co"># 15 a 20</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    C5P0413_value <span class="sc">%in%</span> <span class="dv">21</span><span class="sc">:</span><span class="dv">30</span> <span class="sc">~</span> <span class="st">"3"</span>,      <span class="co"># 21 a 30</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    C5P0413_value <span class="sc">%in%</span> <span class="dv">31</span><span class="sc">:</span><span class="dv">39</span> <span class="sc">~</span> <span class="st">"4"</span>,      <span class="co"># 31 a 39</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    C5P0413_value <span class="sc">%in%</span> <span class="dv">40</span><span class="sc">:</span><span class="dv">49</span> <span class="sc">~</span> <span class="st">"5"</span>,      <span class="co"># 40 a 49</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"6"</span>                     </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  ),     </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">anoest =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    EDUCA5_value <span class="sc">==</span> <span class="dv">98</span>  <span class="sc">~</span> <span class="st">"98"</span>, <span class="co"># No aplica</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    EDUCA5_value <span class="sc">==</span> <span class="dv">99</span>  <span class="sc">~</span> <span class="st">"99"</span>, <span class="co">#NS/NR</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    EDUCA5_value <span class="sc">==</span> <span class="dv">1</span>   <span class="sc">~</span> <span class="st">"1"</span>,  <span class="co"># Sin educacion</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    EDUCA5_value <span class="sc">==</span> <span class="dv">2</span>   <span class="sc">~</span> <span class="st">"2"</span>,  <span class="co"># 1-6</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    EDUCA5_value <span class="sc">==</span> <span class="dv">3</span>   <span class="sc">~</span> <span class="st">"3"</span>,  <span class="co"># 7-12</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    EDUCA5_value <span class="sc">==</span> <span class="dv">4</span>   <span class="sc">~</span> <span class="st">"4"</span> ,  <span class="co"># 12 o mas</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Error"</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">etnia =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    PBLOPER8_value <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"1"</span>, <span class="co"># Indigena</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    PBLOPER8_value <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"2"</span>, <span class="co"># Afro</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"3"</span>), <span class="co"># Otro</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">discapacidad =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    P09DISC7_value <span class="sc">==</span> <span class="dv">63</span> <span class="sc">~</span> <span class="st">"0"</span>, <span class="co"># No discapacitado</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"1"</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    ), <span class="co"># Discapacitado</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">unida =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    UnidasR6_value <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"1"</span>,<span class="co"># Unida</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"2"</span> <span class="co"># Otro</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  value) <span class="sc">%&gt;%</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(mpio, area, sexo, edad, etnia, discapacidad, anoest, unida) <span class="sc">%&gt;%</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(value), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La tabla resultante se muestra en la siguiente tabla.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-7_7737e5bdc4afc9dbe3a0cda5ac2dab0a">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>censo_mrp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/UNFPA/D6/censo_mrp.rds"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>(censo_mrp <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> mpio </th>
   <th style="text-align:left;"> area </th>
   <th style="text-align:left;"> sexo </th>
   <th style="text-align:left;"> edad </th>
   <th style="text-align:left;"> etnia </th>
   <th style="text-align:left;"> discapacidad </th>
   <th style="text-align:left;"> anoest </th>
   <th style="text-align:left;"> unida </th>
   <th style="text-align:right;"> n </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 5 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 27 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 11 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 8 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
<section id="imagenes-satelitales-como-información-auxiliar" class="level2">
<h2 class="anchored" data-anchor-id="imagenes-satelitales-como-información-auxiliar">Imagenes satelitales como información auxiliar</h2>
<p>En la actualidad los datos satelitales que se usan para los diferentes estudios realizados por CEPAL, se obtienen de la plataforma Google Earth Engine ; la cual, integra diferentes lenguajes de programación como Javascript, Python y R mediante el paquete rgee, recientemente vinculado (2021). Todas estas herramientas juntas, permiten obtener imágenes satelitales de los lugares de interés para integrar a la información que ya se tiene disponible y así mejorar la calidad de las estimaciones.</p>
<p>La información satelital empleada para el calculo de los indicadores es la siguiente:</p>
<ul>
<li><p>Luces nocturnas</p>
<p>En su nombre original “Nighttime Lights Time Series Version 4, Defense Meteorological Program Operational Linescan System”. Este es un sistema de datos de uso público, recopilados por la Agencia Meteorológica de la Fuerza Aérea de EE. UU. Pero el procesamiento de las imágenes y los datos es realizado por el Centro Nacional de Datos Geofísicos de la NOAA.</p></li>
<li><p>Urbanismo y evolución de superficie terrestre</p>
<p>En su nombre original “Copernicus Global Land Cover Layers: CGLS-LC100 Collection 3” Estos mapas se encuentran disponibles para los periodos 2015-2019 en todo el mundo. Este esquema de clasificación según Google, puede representar áreas de cobertura terrestre heterogénea mejor que el esquema de clasificación estándar y, como tal, se puede adaptar para el uso de diferentes aplicaciones, por ejemplo, monitoreo forestal, monitoreo de cultivos, biodiversidad y conservación, monitoreo ambiental y seguridad en África, modelado climático, entre muchos otros.</p></li>
</ul>
<p>La base consolidada es se muestra a continuación:</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-8_9d27e78afdc59c41e5814331263f539c">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>statelevel_predictors_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/UNFPA/D6/statelevel_predictors_df.rds"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>(statelevel_predictors_df <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> mpio </th>
   <th style="text-align:right;"> tasa_desocupacion </th>
   <th style="text-align:right;"> stable_lights </th>
   <th style="text-align:right;"> crops.coverfraction </th>
   <th style="text-align:right;"> urban.coverfraction </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:right;"> 0.9704 </td>
   <td style="text-align:right;"> 1067.0353 </td>
   <td style="text-align:right;"> 8119.6157 </td>
   <td style="text-align:right;"> 1153.8706 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0102 </td>
   <td style="text-align:right;"> 0.9634 </td>
   <td style="text-align:right;"> 1148.4235 </td>
   <td style="text-align:right;"> 3211.6549 </td>
   <td style="text-align:right;"> 1236.6510 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0103 </td>
   <td style="text-align:right;"> 0.9798 </td>
   <td style="text-align:right;"> 269.0000 </td>
   <td style="text-align:right;"> 2593.5765 </td>
   <td style="text-align:right;"> 498.4549 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0104 </td>
   <td style="text-align:right;"> 0.9601 </td>
   <td style="text-align:right;"> 16.0000 </td>
   <td style="text-align:right;"> 1490.1373 </td>
   <td style="text-align:right;"> 499.8667 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0105 </td>
   <td style="text-align:right;"> 0.9858 </td>
   <td style="text-align:right;"> 275.8627 </td>
   <td style="text-align:right;"> 11998.7843 </td>
   <td style="text-align:right;"> 750.8118 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0106 </td>
   <td style="text-align:right;"> 0.9859 </td>
   <td style="text-align:right;"> 182.0000 </td>
   <td style="text-align:right;"> 817.7725 </td>
   <td style="text-align:right;"> 375.5098 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0107 </td>
   <td style="text-align:right;"> 0.9734 </td>
   <td style="text-align:right;"> 1811.5961 </td>
   <td style="text-align:right;"> 14613.4824 </td>
   <td style="text-align:right;"> 1741.3137 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0201 </td>
   <td style="text-align:right;"> 0.9486 </td>
   <td style="text-align:right;"> 3871.1843 </td>
   <td style="text-align:right;"> 11183.3725 </td>
   <td style="text-align:right;"> 2033.8863 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0202 </td>
   <td style="text-align:right;"> 0.9734 </td>
   <td style="text-align:right;"> 190.2471 </td>
   <td style="text-align:right;"> 1517.1961 </td>
   <td style="text-align:right;"> 230.4431 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0203 </td>
   <td style="text-align:right;"> 0.9867 </td>
   <td style="text-align:right;"> 106.0000 </td>
   <td style="text-align:right;"> 4142.7569 </td>
   <td style="text-align:right;"> 340.3882 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
<section id="actualización-de-tablas-censales-para-el-modelo-sae" class="level2">
<h2 class="anchored" data-anchor-id="actualización-de-tablas-censales-para-el-modelo-sae">Actualización de tablas censales para el modelo SAE</h2>
<p>No todos los países en la región cuentan con un censo reciente, de esta manera, es conveniente actualizar los conteos de población del censo por subgrupos. Para este ejercicio, es necesario hacer uso de los conteos marginales que se obtienen a partir de la encuesta para actualizar los conteos censales. Luego, al llegar a la etapa de predicciones, se debe garantizar que la predicción sea coherente con la distribución actualizada de la población entre los grupos seleccionados.</p>
<p>Cabe señalar, que la necesidad de trabajar con tablas censales actualizadas no es enteramente exclusiva de la estimación en áreas pequeñas, ya que en en el campo de la demografía son ampliamente utilizadas. Esta área del conocimiento ofrece diferentes métodos empleados para actualizar los recuentos censales según Rao y Molina (2015), donde también se emplean técnicas de actualización de tablas para generar datos sintéticos de población. En este caso, a partir de los datos de la encuesta, se ajustan las proporciones de la tabla censal actualizada, respecto a la selección de muestras de los datos. Por lo anterior, es necesario definir de manera teórica el proceso realizado en la actualización intercensal.</p>
<ul>
<li>SPREE basado en IPF</li>
</ul>
<p>La primera versión de los métodos SPREE (Structure preserving estimators) fue propuesta por Purcell and Kish (1980) como una herramienta para actualizar conteos o proporciones de una o más variables categóricas de interés de acuerdo con dominios de estudio, para años post-censales. La familia de los métodos SPREE es popular en el contexto de estimacionesen áreas pequeñas.</p>
<p>El procedimiento para obtener tablas actualizadas SPREE, se lleva a cabo por medio del ajuste proporcional iterativo (Iterative Proportional Fitting, IPF). Ahora, suponga que <span class="math inline">\(Y\)</span> es una tabla desconocida (objetivo) en el periodo actual <span class="math inline">\(t_1\)</span>, por lo tanto, se espera crear una tabla <span class="math inline">\(\hat{Y}\)</span> partir de una tabla censal <span class="math inline">\(Z\)</span> en un periodo anterior <span class="math inline">\(t_0\)</span> y un conjunto de márgenes provenientes de una encuesta reciente <span class="math inline">\(Y_{(a.)}\)</span> y <span class="math inline">\(Y_{(.J )}\)</span>.</p>
<p>Utilizando el censo anterior <span class="math inline">\(Z\)</span> como base o punto de partida, el primer ciclo del algoritmo se describe a continuación:</p>
<ol type="1">
<li><p>Las celdas de la tabla se ajustan a los primeros márgenes fila de <span class="math inline">\(Y_{(\bullet J)}\)</span>:</p>
<p><span class="math display">\[
\hat{Y}_{aJ}^{\left(1\right)}=Z_{aJ}\frac{Y_{\bullet J}}{Z'_{\bullet J}}
\]</span></p></li>
<li><p>Las celdas ajustadas en el paso anterior se vuelven a ajustar, ahora con los márgenes columna de: <span class="math inline">\(\hat{Y}^{(1)}\)</span>:</p>
<p><span class="math display">\[
\hat{Y}_{\left(aJ\right)}^{\left(2\right)}=\hat{Y}_{aJ}^{\left(1\right)}\frac{Y_{a\bullet}}{\hat{Y}_{a}^{\left(1\right)}}
\]</span></p></li>
<li><p>Se ajustan las celdas nuevamente, con los márgenes fila de <span class="math inline">\(\hat{Y}^{(2)}\)</span>:</p></li>
</ol>
<p><span class="math display">\[
    \hat{Y}_{aJ}^{\left(3\right)}=\hat{Y}_{aJ}^{\left(2\right)}\frac{\hat{Y}_{\bullet J}^{\left(2\right)}}{Y_{\bullet J}^{\left(2\right)}}
\]</span></p>
<p>De esta forma, el IPF sigue un proceso iterativo, repitiendo los últimos dos pasos finales hasta alcanzar convergencia.</p>
<p>Este estimador logra minimizar la distancia <span class="math inline">\(\chi^2\)</span>:</p>
<p><span class="math display">\[
\chi^{2}=\sum_{a=1}^{A}\sum_{j=1}^{J}\frac{\left(Y_{aJ}-\hat{Y}_{aj}\right)^{2}}{\hat{Y}_{aj}}
\]</span></p>
<ul>
<li><p>Métodos de calibración</p>
<p>La idea básica de los métodos de calibración es utilizar información auxiliar relevante para ajustar los pesos muestrales, de tal forma que se puedan mejorar (afinar) las estimaciones basadas en los datos de encuesta. Si bien es cierto los métodos de calibración nacen para buscar soluciones a problemas en el campo de encuestas por muestreo, se han encontrado diversas utilidades adicionales, por ejemplo, su aplicación en el contexto de estimaciones en áreas pequeñas.</p></li>
</ul>
</section>
<section id="estimación-del-modelo-para-d6" class="level2">
<h2 class="anchored" data-anchor-id="estimación-del-modelo-para-d6">Estimación del modelo para D6</h2>
<p>Se debe cargar el archivo <code>encuesta_mrp.rds</code> y el archivo <code>statelevel_predictors_df.rds</code> creado previamente. A continuaciones preparamos los datos para el indicador <em>D6</em></p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-9_f1d47526a225f37fec41100ba9da727a">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>byAgrega <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">"mpio"</span>, <span class="st">"area"</span>, <span class="st">"edad"</span>, <span class="st">"etnia"</span>,  </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"anoest"</span>, <span class="st">"discapacidad"</span>, <span class="st">"unida"</span> )  </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>encuesta_df_agg <span class="ot">&lt;-</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  encuesta_mrp <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by_at</span>(<span class="fu">all_of</span>(byAgrega)) <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">pobres =</span> <span class="fu">sum</span>(usametodo), <span class="co">#D6</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">nopobres =</span> n <span class="sc">-</span> usametodo, <span class="at">.groups =</span> <span class="st">"drop"</span>) </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>encuesta_df_agg <span class="sc">%&lt;&gt;%</span> <span class="fu">inner_join</span>(statelevel_predictors_df, </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">by =</span> <span class="st">"mpio"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Con la información ordenada ajustamos el siguiente modelo</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-10_2b58e5bf86041aa0a5174211ba821147">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glmer</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(pobres, nopobres) <span class="sc">~</span>  (<span class="dv">1</span> <span class="sc">|</span> mpio) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> edad) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> area) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> anoest) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> etnia) <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> mpio<span class="sc">:</span>area) <span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> mpio<span class="sc">:</span>etnia) <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> mpio<span class="sc">:</span>edad) <span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> mpio<span class="sc">:</span>anoest) <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> area<span class="sc">:</span>etnia) <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> area<span class="sc">:</span>anoest) <span class="sc">+</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> etnia<span class="sc">:</span>anoest) <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> edad<span class="sc">:</span>anoest) <span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> discapacidad) <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>      tasa_desocupacion <span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>      stable_lights <span class="sc">+</span> </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  crops.coverfraction <span class="sc">+</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  urban.coverfraction <span class="sc">+</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    unida,</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> encuesta_df_agg,</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">glmerControl</span>(<span class="at">tolPwrss =</span> <span class="fl">1e-3</span>),</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El resultado del modelo es el siguiente.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-11_6d77b982cbace3e736311e14af6f25da">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fit<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"../Data/UNFPA/D6/fit_mrp_logit.rds"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>(<span class="fu">coef</span>(fit)<span class="sc">$</span>mpio <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> (Intercept) </th>
   <th style="text-align:right;"> tasa_desocupacion </th>
   <th style="text-align:right;"> stable_lights </th>
   <th style="text-align:right;"> crops.coverfraction </th>
   <th style="text-align:right;"> urban.coverfraction </th>
   <th style="text-align:right;"> unida2 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:right;"> -0.2157 </td>
   <td style="text-align:right;"> 1.5754 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -2.4694 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0102 </td>
   <td style="text-align:right;"> -0.3363 </td>
   <td style="text-align:right;"> 1.5754 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -2.4694 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0103 </td>
   <td style="text-align:right;"> -0.2725 </td>
   <td style="text-align:right;"> 1.5754 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -2.4694 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0104 </td>
   <td style="text-align:right;"> -0.2871 </td>
   <td style="text-align:right;"> 1.5754 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -2.4694 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0105 </td>
   <td style="text-align:right;"> -0.1812 </td>
   <td style="text-align:right;"> 1.5754 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -2.4694 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0106 </td>
   <td style="text-align:right;"> -0.1177 </td>
   <td style="text-align:right;"> 1.5754 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -2.4694 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0107 </td>
   <td style="text-align:right;"> -0.2231 </td>
   <td style="text-align:right;"> 1.5754 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -2.4694 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0201 </td>
   <td style="text-align:right;"> -0.1929 </td>
   <td style="text-align:right;"> 1.5754 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -2.4694 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0202 </td>
   <td style="text-align:right;"> -0.2284 </td>
   <td style="text-align:right;"> 1.5754 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -2.4694 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0203 </td>
   <td style="text-align:right;"> -0.2399 </td>
   <td style="text-align:right;"> 1.5754 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -2.4694 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<section id="predicción-en-el-censo" class="level3">
<h3 class="anchored" data-anchor-id="predicción-en-el-censo">Predicción en el censo</h3>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-12_b6f9c899749ea5f7db9e67afb859a389">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="ot">&lt;-</span> censo_mrp <span class="sc">%&gt;%</span>  </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">group_by_at</span>(byAgrega) <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(n), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(poststrat_df, statelevel_predictors_df,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">by =</span> <span class="st">"mpio"</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>epred_mat <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> poststrat_df, </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">allow.new.levels =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Validación de las predicciones</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-13_6dc25a19514bc92db584a109a43c4e08">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(epred_mat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(epred_mat <span class="sc">&lt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>Asignar la predicción a la base de <code>poststrat_df</code></p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-14_de6c2124c21b6b713a4b633ecae47fe3">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>poststrat_df<span class="sc">$</span>epred_mat <span class="ot">&lt;-</span> epred_mat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="metodología-de-benchmarking" class="level1">
<h1>Metodología de Benchmarking</h1>
<ol type="1">
<li>Validarse los nombres de las covariables disponibles en censo y encuesta, que deben ser las mismas con las que se han venido trabajando, para este caso resultaron</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-15_5914c80a15c6afd66c9fc8db86cd81aa">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>names_cov <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"area"</span>, <span class="st">"edad"</span>, <span class="st">"etnia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Calcular las estimaciones para cada una de las variables de la base de datos de <code>encuesta_mrp</code> utilizando el indicador de interés.</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-16_a07dec4b5ed8eaf8f73d180ae6606050">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>encuesta_mrp <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">pobreza =</span> usametodo)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>paso <span class="ot">&lt;-</span> <span class="fu">sapply</span>(names_cov, <span class="cf">function</span>(byi){</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    encuesta_mrp <span class="sc">%&gt;%</span> </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by_at</span>(<span class="fu">all_of</span>(byi)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">Nhat =</span> <span class="fu">sum</span>(fexp),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">t_pobreza =</span> <span class="fu">sum</span>(pobreza<span class="sc">*</span>fexp),</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">medias =</span> <span class="fu">weighted.mean</span>(pobreza,fexp))</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>( Categoría <span class="ot">=</span> <span class="fu">unlist</span>(paso[<span class="st">"area"</span>,]),</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">Total =</span> <span class="fu">unlist</span>(paso[<span class="st">"t_pobreza"</span>,]),</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">Hat_Media =</span> <span class="fu">unlist</span>(paso[<span class="st">"medias"</span>,])) <span class="sc">%&gt;%</span> </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tba</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:left;"> Categoría </th>
   <th style="text-align:right;"> Total </th>
   <th style="text-align:right;"> Hat_Media </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> area1 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:right;"> 741693.8 </td>
   <td style="text-align:right;"> 0.5686 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> area2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 2999526.1 </td>
   <td style="text-align:right;"> 0.5202 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad1 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 232827.0 </td>
   <td style="text-align:right;"> 0.1766 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 1223562.2 </td>
   <td style="text-align:right;"> 0.5924 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad3 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:right;"> 1303975.6 </td>
   <td style="text-align:right;"> 0.6903 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad4 </td>
   <td style="text-align:left;"> 5 </td>
   <td style="text-align:right;"> 980855.0 </td>
   <td style="text-align:right;"> 0.5457 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> etnia1 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 953470.1 </td>
   <td style="text-align:right;"> 0.5546 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> etnia2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 458497.5 </td>
   <td style="text-align:right;"> 0.5541 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> etnia3 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 2329252.4 </td>
   <td style="text-align:right;"> 0.5149 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<ol start="3" type="1">
<li>Crear variables dummys en <code>poststrat_df</code> y multiplicar cada variable por la predicción <code>epred_mat</code></li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-17_982cefe53be4caf6628c643761ff4f73">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  fastDummies<span class="sc">::</span><span class="fu">dummy_cols</span>(<span class="at">select_columns =</span> names_cov,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">remove_selected_columns =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">matches</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d$"</span>)) ,<span class="sc">~</span>.<span class="sc">*</span>poststrat_df<span class="sc">$</span>epred_mat)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>( poststrat_df <span class="sc">%&gt;%</span> <span class="fu">select</span>(names_cov,<span class="fu">matches</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d$"</span>)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> area </th>
   <th style="text-align:left;"> edad </th>
   <th style="text-align:left;"> etnia </th>
   <th style="text-align:right;"> area_0 </th>
   <th style="text-align:right;"> area_1 </th>
   <th style="text-align:right;"> edad_2 </th>
   <th style="text-align:right;"> edad_3 </th>
   <th style="text-align:right;"> edad_4 </th>
   <th style="text-align:right;"> edad_5 </th>
   <th style="text-align:right;"> etnia_1 </th>
   <th style="text-align:right;"> etnia_2 </th>
   <th style="text-align:right;"> etnia_3 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.1440 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1440 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1440 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.7007 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.7007 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.7007 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.1654 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1654 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1654 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.6501 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.6501 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.6501 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.1359 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1359 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1359 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.1156 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1156 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1156 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.1944 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1944 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1944 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 0.7040 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.7040 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.7040 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 0.1676 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1676 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.1676 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 0.1412 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1412 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.1412 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 0.1993 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1993 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.1993 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.1479 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1479 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.1479 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.7037 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.7037 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.7037 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.1673 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1673 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.1673 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.6639 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.6639 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.6639 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.1432 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1432 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.1432 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.6598 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.6598 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.6598 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.1410 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1410 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.1410 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.6173 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.6173 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.6173 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.1201 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1201 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.1201 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<ol start="4" type="1">
<li>Con la función <code>calib</code> se procede a calcular los <span class="math inline">\(g_k\)</span>, verificando que el proceso se haya realizado con éxito y exista convergencia</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-18_6fe28a8b29cc006beb8f6ec6cad7d1d7">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sampling)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>poststrat_df<span class="sc">$</span>gk <span class="ot">&lt;-</span> <span class="fu">calib</span>(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Xs =</span> poststrat_df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d$"</span>)), <span class="do">## Variable dummys </span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> poststrat_df<span class="sc">$</span>n,                            <span class="do">## Conteos en el post-estrato</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">total =</span> <span class="fu">unlist</span>(paso[<span class="st">"t_pobreza"</span>,]),            <span class="do">## Valores objetivo</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">method=</span><span class="st">"logit"</span>)                                <span class="do">## Método empleado</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="fu">checkcalibration</span>(<span class="at">Xs =</span> poststrat_df <span class="sc">%&gt;%</span> </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d$"</span>)), </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">d =</span> poststrat_df<span class="sc">$</span>n,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">total =</span> <span class="fu">unlist</span>(paso[<span class="st">"t_pobreza"</span>,]),</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">g =</span> poststrat_df<span class="sc">$</span>gk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$message
[1] "the calibration is done"

$result
[1] TRUE

$value
[1] 1e-06</code></pre>
</div>
</div>
<ol start="5" type="1">
<li>Realizar validación sobre los resultados obtenidos.</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-19_24bdd4af986c9679622ba783f1453a37">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(poststrat_df<span class="sc">$</span>gk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA_fig/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Continuando con la validación se define define la columna <code>pobreza2</code></p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-20_c69e32e4aa5b43c7040b18476788272e">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pobreza2 =</span> epred_mat <span class="sc">*</span>gk,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">pobreza2 =</span> <span class="fu">ifelse</span>(pobreza2<span class="sc">&gt;</span><span class="dv">1</span>, <span class="dv">1</span>, pobreza2),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">pobreza2 =</span> <span class="fu">ifelse</span>(pobreza2<span class="sc">&lt;</span><span class="dv">0</span>, <span class="dv">0</span>, pobreza2)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Paso seguido realizamos el calculo de los totales calibrados.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-21_9287e1371de16c96257a4e832671f7a1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">map_df</span>(names_cov ,<span class="sc">~</span> poststrat_df <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by_at</span>(<span class="fu">all_of</span>(.x)) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">summarise</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">Nhat =</span> <span class="fu">sum</span>(n),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">t_pobreza =</span> <span class="fu">sum</span>(n<span class="sc">*</span>pobreza2)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">transmute</span>(</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">Cal_Media =</span> t_pobreza<span class="sc">/</span>Nhat,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">Variable =</span> <span class="fu">paste0</span>(.x, <span class="fu">get</span>(.x) ))) </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>( Categoría <span class="ot">=</span> <span class="fu">unlist</span>(paso[<span class="st">"area"</span>,]),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">Hat_Media =</span> <span class="fu">unlist</span>(paso[<span class="st">"medias"</span>,])) <span class="sc">%&gt;%</span> </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(temp) <span class="sc">%&gt;%</span> <span class="fu">tba</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:left;"> Categoría </th>
   <th style="text-align:right;"> Hat_Media </th>
   <th style="text-align:right;"> Cal_Media </th>
   <th style="text-align:left;"> Variable </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> area1 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:right;"> 0.5686 </td>
   <td style="text-align:right;"> 0.5638 </td>
   <td style="text-align:left;"> area0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> area2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.5202 </td>
   <td style="text-align:right;"> 0.5191 </td>
   <td style="text-align:left;"> area1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad1 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 0.1766 </td>
   <td style="text-align:right;"> 0.1760 </td>
   <td style="text-align:left;"> edad2 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.5924 </td>
   <td style="text-align:right;"> 0.5907 </td>
   <td style="text-align:left;"> edad3 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad3 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:right;"> 0.6903 </td>
   <td style="text-align:right;"> 0.6880 </td>
   <td style="text-align:left;"> edad4 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad4 </td>
   <td style="text-align:left;"> 5 </td>
   <td style="text-align:right;"> 0.5457 </td>
   <td style="text-align:right;"> 0.5434 </td>
   <td style="text-align:left;"> edad5 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> etnia1 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.5546 </td>
   <td style="text-align:right;"> 0.5512 </td>
   <td style="text-align:left;"> etnia1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> etnia2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 0.5541 </td>
   <td style="text-align:right;"> 0.5515 </td>
   <td style="text-align:left;"> etnia2 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> etnia3 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.5149 </td>
   <td style="text-align:right;"> 0.5138 </td>
   <td style="text-align:left;"> etnia3 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>También es posible hacer validaciones visuales.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-22_35dad6b29da31a52addf0a0dab0ca8aa">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"0Recursos/0Funciones/funciones_mrp.R"</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">yk_lmer =</span> epred_mat, </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">yk_bench =</span> pobreza2)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>diseno <span class="ot">&lt;-</span> encuesta_mrp <span class="sc">%&gt;%</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">yk_dir =</span> pobreza) <span class="sc">%&gt;%</span> </span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">weights =</span> fexp)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>bynames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"area"</span>, <span class="st">"anoest"</span>, <span class="st">"edad"</span>, <span class="st">"discapacidad"</span>, <span class="st">"etnia"</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>plot_uni <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> <span class="fu">setNames</span>(bynames, bynames),</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> <span class="fu">plot_compare2</span>(</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_diseno =</span> diseno,</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">poststrat =</span> poststrat_df,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">by1 =</span> .x</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>plot_uni <span class="ot">&lt;-</span> (plot_uni<span class="sc">$</span>area<span class="sc">$</span>Plot<span class="sc">$</span>plot1 <span class="sc">+</span> plot_uni<span class="sc">$</span>anoest<span class="sc">$</span>Plot<span class="sc">$</span>plot1)<span class="sc">/</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>      (plot_uni<span class="sc">$</span>edad<span class="sc">$</span>Plot<span class="sc">$</span>plot1<span class="sc">+</span> plot_uni<span class="sc">$</span>discapacidad<span class="sc">$</span>Plot<span class="sc">$</span>plot1<span class="sc">+</span> plot_uni<span class="sc">$</span>etnia<span class="sc">$</span>Plot<span class="sc">$</span>plot1)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>plot_uni</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA_fig/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="estimación-y-mapa-del-indicador." class="level2">
<h2 class="anchored" data-anchor-id="estimación-y-mapa-del-indicador.">Estimación y mapa del indicador.</h2>
<p>Después de todos el proceso de estandarización, creación de variables covariables, estimación del modelo y validaciones realizadas, la estimación puntual se reduce a operaciones algebraicas simples.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-23_0db3e466b39f012ef98bcc04d18bcd95">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>poststrat_df2 <span class="ot">&lt;-</span>  poststrat_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(anoest <span class="sc">!=</span> <span class="st">"99"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>bynames  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"area"</span>,  <span class="st">"edad"</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"etnia"</span>, <span class="st">"anoest"</span>, <span class="st">"discapacidad"</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>bynames <span class="ot">&lt;-</span>   <span class="fu">t</span>(<span class="fu">combn</span>(bynames, <span class="dv">2</span>)) </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>bynames <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="st">"mpio"</span>,<span class="st">"mpio"</span>),bynames )</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>dat_df <span class="ot">=</span> <span class="fu">map</span>(</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(bynames),</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> poststrat_df2 <span class="sc">%&gt;%</span> <span class="fu">group_by_at</span>(<span class="fu">vars</span>(<span class="st">"mpio"</span>, bynames[.x, ])) <span class="sc">%&gt;%</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">Benchmarking_estimate =</span> <span class="fu">sum</span>(n <span class="sc">*</span> pobreza2) <span class="sc">/</span> <span class="fu">sum</span>(n),</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En este paso validamos que las estimaciones no superen el valor de 1 o sean menores o iguales a creo.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-24_b56cc3376aa39eb44268fb5be9540ebc">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>dat_df <span class="sc">%&gt;%</span> <span class="fu">map_dbl</span>(<span class="sc">~</span>.x <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">summarise</span>(<span class="at">Validar =</span> <span class="fu">sum</span>(Benchmarking_estimate <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                                            Benchmarking_estimate <span class="sc">&lt;</span> <span class="dv">0</span>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">as.numeric</span>(.<span class="sc">$</span>Validar))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0 0 0 0 0 0 0 0 0 0 0</code></pre>
</div>
</div>
<section id="mapas-para-el-indicador-d6" class="level3">
<h3 class="anchored" data-anchor-id="mapas-para-el-indicador-d6">Mapas para el indicador D6</h3>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-25_2983908cd8b6cc867f2fb24c38d79ab1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>ShapeSAE <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"../Shape/PROVINCIAS.shp"</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>ShapeSAE <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">mpio =</span> IDPROV,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">nombre=</span> PROVINCIA</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>P1_ingresolp <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(ShapeSAE <span class="sc">%&gt;%</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">left_join</span>(dat_df[[<span class="dv">1</span>]],  <span class="at">by =</span> <span class="st">"mpio"</span>))</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>brks_lp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="dv">1</span>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>Mapa_lp <span class="ot">&lt;-</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  P1_ingresolp <span class="sc">+</span> <span class="fu">tm_polygons</span>(</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Benchmarking_estimate"</span>,</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> brks_lp,</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"D6"</span>,</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"-YlOrRd"</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="fu">tm_layout</span>(<span class="at">asp =</span> <span class="dv">0</span>)</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>Mapa_lp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA_fig/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="estimación-del-indicador-d6m-uso-de-métodos-anticonceptivos" class="level1">
<h1>Estimación del indicador D6m (Uso de métodos anticonceptivos)</h1>
<p>El procedimiento descrito previamente se repite para los indicadores <em>D6m</em> y <em>NI</em>.</p>
<p>Lectura de insumos</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-26_1ac41254b922bf17242b515cd840d8ca">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>encuesta_mrp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/UNFPA/D6m/encuesta_mrp.rds"</span>) </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>statelevel_predictors_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/UNFPA/D6m/statelevel_predictors_df.rds"</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>censo_mrp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/UNFPA/D6m/censo_mrp.rds"</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/UNFPA/D6m/fit_mrp_logit.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Por el proceso de estandarizado realizado es renombrado el indicador <em>usamoderno</em> como <em>probreza</em>, el modelo conteplado para el indicador es:</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-27_6a191b6b8de5dde380989110ad6443d2">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">@</span>call</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>glmer(formula = cbind(pobres, nopobres) ~ (1 | mpio) + (1 | edad) + 
    (1 | area) + (1 | anoest) + (1 | etnia) + (1 | mpio:area) + 
    (1 | mpio:etnia) + (1 | mpio:edad) + (1 | mpio:anoest) + 
    (1 | area:etnia) + (1 | area:edad) + (1 | area:anoest) + 
    (1 | etnia:edad) + (1 | etnia:anoest) + (1 | edad:anoest) + 
    (1 | discapacidad) + tasa_desocupacion + stable_lights + 
    crops.coverfraction + urban.coverfraction + unida, data = encuesta_df_agg, 
    family = binomial(link = "logit"))</code></pre>
</div>
</div>
<p>El resultado del modelo es el siguiente.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-28_19a86cea4acd3645682d9497637a9ec3">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>(<span class="fu">coef</span>(fit)<span class="sc">$</span>mpio <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> (Intercept) </th>
   <th style="text-align:right;"> tasa_desocupacion </th>
   <th style="text-align:right;"> stable_lights </th>
   <th style="text-align:right;"> crops.coverfraction </th>
   <th style="text-align:right;"> urban.coverfraction </th>
   <th style="text-align:right;"> unida2 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:right;"> -1.5979 </td>
   <td style="text-align:right;"> 1.8377 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -1.7063 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0102 </td>
   <td style="text-align:right;"> -1.7356 </td>
   <td style="text-align:right;"> 1.8377 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -1.7063 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0103 </td>
   <td style="text-align:right;"> -1.5944 </td>
   <td style="text-align:right;"> 1.8377 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -1.7063 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0104 </td>
   <td style="text-align:right;"> -2.0987 </td>
   <td style="text-align:right;"> 1.8377 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -1.7063 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0105 </td>
   <td style="text-align:right;"> -1.4423 </td>
   <td style="text-align:right;"> 1.8377 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -1.7063 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0106 </td>
   <td style="text-align:right;"> -1.3545 </td>
   <td style="text-align:right;"> 1.8377 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -1.7063 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0107 </td>
   <td style="text-align:right;"> -1.4991 </td>
   <td style="text-align:right;"> 1.8377 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -1.7063 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0201 </td>
   <td style="text-align:right;"> -1.5783 </td>
   <td style="text-align:right;"> 1.8377 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -1.7063 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0202 </td>
   <td style="text-align:right;"> -1.6071 </td>
   <td style="text-align:right;"> 1.8377 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -1.7063 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0203 </td>
   <td style="text-align:right;"> -1.7144 </td>
   <td style="text-align:right;"> 1.8377 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -1.7063 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<section id="predicción-en-el-censo-1" class="level3">
<h3 class="anchored" data-anchor-id="predicción-en-el-censo-1">Predicción en el censo</h3>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-29_65ba33f330352e5894782f3358fcad2f">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a> byAgrega <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"mpio"</span>, <span class="st">"area"</span>, <span class="st">"edad"</span>, <span class="st">"etnia"</span>,</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"anoest"</span>, <span class="st">"discapacidad"</span>, <span class="st">"unida"</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="ot">&lt;-</span> censo_mrp <span class="sc">%&gt;%</span>  </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">group_by_at</span>(byAgrega) <span class="sc">%&gt;%</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(n), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(poststrat_df, statelevel_predictors_df,</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">by =</span> <span class="st">"mpio"</span>)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>epred_mat <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> poststrat_df, </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">allow.new.levels =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Validación de las predicciones</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-30_fe9b5e5b2c9c380443f17dcdf387ab73">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(epred_mat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(epred_mat <span class="sc">&lt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>Asignar la predicción a la base de <code>poststrat_df</code></p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-31_b4344e414c6a0a3514198b6961d77874">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>poststrat_df<span class="sc">$</span>epred_mat <span class="ot">&lt;-</span> epred_mat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="benchmarking" class="level3">
<h3 class="anchored" data-anchor-id="benchmarking">Benchmarking</h3>
<ol type="1">
<li>Validarse los nombres de las covariables disponibles en censo y encuesta, que deben ser las mismas con las que se han venido trabajando, para este caso resultaron</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-32_edac1bb2f26f76b68ea54521637abcb2">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>names_cov <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"area"</span>, <span class="st">"edad"</span>, <span class="st">"etnia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Calcular las estimaciones para cada una de las variables de la base de datos de <code>encuesta_mrp</code> utilizando el indicador de interés.</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-33_dc913e86cb2e950b38c54f5ad08a1cbe">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>encuesta_mrp <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">pobreza =</span> usamoderno)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>paso <span class="ot">&lt;-</span> <span class="fu">sapply</span>(names_cov, <span class="cf">function</span>(byi){</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    encuesta_mrp <span class="sc">%&gt;%</span> </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by_at</span>(<span class="fu">all_of</span>(byi)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">Nhat =</span> <span class="fu">sum</span>(fexp),</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">t_pobreza =</span> <span class="fu">sum</span>(pobreza<span class="sc">*</span>fexp),</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">medias =</span> <span class="fu">weighted.mean</span>(pobreza,fexp))</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>( Categoría <span class="ot">=</span> <span class="fu">unlist</span>(paso[<span class="st">"area"</span>,]),</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">Total =</span> <span class="fu">unlist</span>(paso[<span class="st">"t_pobreza"</span>,]),</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">Hat_Media =</span> <span class="fu">unlist</span>(paso[<span class="st">"medias"</span>,])) <span class="sc">%&gt;%</span> </span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tba</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:left;"> Categoría </th>
   <th style="text-align:right;"> Total </th>
   <th style="text-align:right;"> Hat_Media </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> area1 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:right;"> 487397.7 </td>
   <td style="text-align:right;"> 0.3736 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> area2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 2350587.6 </td>
   <td style="text-align:right;"> 0.4077 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad1 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 200022.6 </td>
   <td style="text-align:right;"> 0.1517 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 982386.9 </td>
   <td style="text-align:right;"> 0.4756 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad3 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:right;"> 970202.5 </td>
   <td style="text-align:right;"> 0.5136 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad4 </td>
   <td style="text-align:left;"> 5 </td>
   <td style="text-align:right;"> 685373.2 </td>
   <td style="text-align:right;"> 0.3813 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> etnia1 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 654095.8 </td>
   <td style="text-align:right;"> 0.3805 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> etnia2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 347875.2 </td>
   <td style="text-align:right;"> 0.4204 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> etnia3 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 1836014.2 </td>
   <td style="text-align:right;"> 0.4059 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<ol start="3" type="1">
<li>Crear variables dummys en <code>poststrat_df</code> y multiplicar cada variable por la predicción <code>epred_mat</code></li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-34_30f89c2ce795a969bceeeed55f7f0ac8">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  fastDummies<span class="sc">::</span><span class="fu">dummy_cols</span>(<span class="at">select_columns =</span> names_cov,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">remove_selected_columns =</span> <span class="cn">FALSE</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">matches</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d$"</span>)) ,<span class="sc">~</span>.<span class="sc">*</span>poststrat_df<span class="sc">$</span>epred_mat)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>( poststrat_df <span class="sc">%&gt;%</span> <span class="fu">select</span>(names_cov,<span class="fu">matches</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d$"</span>)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> area </th>
   <th style="text-align:left;"> edad </th>
   <th style="text-align:left;"> etnia </th>
   <th style="text-align:right;"> area_0 </th>
   <th style="text-align:right;"> area_1 </th>
   <th style="text-align:right;"> edad_2 </th>
   <th style="text-align:right;"> edad_3 </th>
   <th style="text-align:right;"> edad_4 </th>
   <th style="text-align:right;"> edad_5 </th>
   <th style="text-align:right;"> etnia_1 </th>
   <th style="text-align:right;"> etnia_2 </th>
   <th style="text-align:right;"> etnia_3 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.1040 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1040 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1040 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.4168 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.4168 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.4168 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.1148 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1148 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1148 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.3862 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.3862 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.3862 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.1025 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1025 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1025 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.0881 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0881 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0881 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.1426 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1426 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1426 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 0.4471 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.4471 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.4471 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 0.1280 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1280 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.1280 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 0.1147 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1147 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.1147 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 0.1580 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1580 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.1580 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.1199 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1199 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.1199 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.4569 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.4569 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.4569 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.1325 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1325 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.1325 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.4156 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.4156 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.4156 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.1143 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1143 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.1143 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.4251 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.4251 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.4251 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.1183 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1183 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.1183 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.3846 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.3846 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.3846 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.1019 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.1019 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.1019 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<ol start="4" type="1">
<li>Con la función <code>calib</code> se procede a calcular los <span class="math inline">\(g_k\)</span>, verificando que el proceso se haya realizado con éxito y exista convergencia</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-35_a2a9bedfa592915875bd3d387da0d3fa">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sampling)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>poststrat_df<span class="sc">$</span>gk <span class="ot">&lt;-</span> <span class="fu">calib</span>(</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Xs =</span> poststrat_df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d$"</span>)), <span class="do">## Variable dummys </span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> poststrat_df<span class="sc">$</span>n,                            <span class="do">## Conteos en el post-estrato</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">total =</span> <span class="fu">unlist</span>(paso[<span class="st">"t_pobreza"</span>,]),            <span class="do">## Valores objetivo</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">method=</span><span class="st">"logit"</span>)                                <span class="do">## Método empleado</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="fu">checkcalibration</span>(<span class="at">Xs =</span> poststrat_df <span class="sc">%&gt;%</span> </span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d$"</span>)), </span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">d =</span> poststrat_df<span class="sc">$</span>n,</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">total =</span> <span class="fu">unlist</span>(paso[<span class="st">"t_pobreza"</span>,]),</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">g =</span> poststrat_df<span class="sc">$</span>gk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$message
[1] "the calibration is done"

$result
[1] TRUE

$value
[1] 1e-06</code></pre>
</div>
</div>
<ol start="5" type="1">
<li>Realizar validación sobre los resultados obtenidos.</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-36_36c4ef27a360c489cde445139208fbc3">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(poststrat_df<span class="sc">$</span>gk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA_fig/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Continuando con la validación se define define la columna <code>pobreza2</code></p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-37_1e17f809aad95aa4eb7205ff01dc9406">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pobreza2 =</span> epred_mat <span class="sc">*</span>gk,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">pobreza2 =</span> <span class="fu">ifelse</span>(pobreza2<span class="sc">&gt;</span><span class="dv">1</span>, <span class="dv">1</span>, pobreza2),</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">pobreza2 =</span> <span class="fu">ifelse</span>(pobreza2<span class="sc">&lt;</span><span class="dv">0</span>, <span class="dv">0</span>, pobreza2)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Paso seguido realizamos el calculo de los totales calibrados.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-38_0b21a901d42c78565f13f40bc8b11dd9">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">map_df</span>(names_cov ,<span class="sc">~</span> poststrat_df <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by_at</span>(<span class="fu">all_of</span>(.x)) <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">summarise</span>(</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">Nhat =</span> <span class="fu">sum</span>(n),</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">t_pobreza =</span> <span class="fu">sum</span>(n<span class="sc">*</span>pobreza2)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">transmute</span>(</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">Cal_Media =</span> t_pobreza<span class="sc">/</span>Nhat,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">Variable =</span> <span class="fu">paste0</span>(.x, <span class="fu">get</span>(.x) ))) </span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>( Categoría <span class="ot">=</span> <span class="fu">unlist</span>(paso[<span class="st">"area"</span>,]),</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">Hat_Media =</span> <span class="fu">unlist</span>(paso[<span class="st">"medias"</span>,])) <span class="sc">%&gt;%</span> </span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(temp) <span class="sc">%&gt;%</span> <span class="fu">tba</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:left;"> Categoría </th>
   <th style="text-align:right;"> Hat_Media </th>
   <th style="text-align:right;"> Cal_Media </th>
   <th style="text-align:left;"> Variable </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> area1 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:right;"> 0.3736 </td>
   <td style="text-align:right;"> 0.3705 </td>
   <td style="text-align:left;"> area0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> area2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.4077 </td>
   <td style="text-align:right;"> 0.4068 </td>
   <td style="text-align:left;"> area1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad1 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 0.1517 </td>
   <td style="text-align:right;"> 0.1512 </td>
   <td style="text-align:left;"> edad2 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.4756 </td>
   <td style="text-align:right;"> 0.4743 </td>
   <td style="text-align:left;"> edad3 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad3 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:right;"> 0.5136 </td>
   <td style="text-align:right;"> 0.5119 </td>
   <td style="text-align:left;"> edad4 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad4 </td>
   <td style="text-align:left;"> 5 </td>
   <td style="text-align:right;"> 0.3813 </td>
   <td style="text-align:right;"> 0.3797 </td>
   <td style="text-align:left;"> edad5 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> etnia1 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.3805 </td>
   <td style="text-align:right;"> 0.3781 </td>
   <td style="text-align:left;"> etnia1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> etnia2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 0.4204 </td>
   <td style="text-align:right;"> 0.4184 </td>
   <td style="text-align:left;"> etnia2 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> etnia3 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.4059 </td>
   <td style="text-align:right;"> 0.4050 </td>
   <td style="text-align:left;"> etnia3 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>También es posible hacer validaciones visuales.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-39_6e532093c3f56fbacee6a3078e87acea">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"0Recursos/0Funciones/funciones_mrp.R"</span>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">yk_lmer =</span> epred_mat, </span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">yk_bench =</span> pobreza2)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>diseno <span class="ot">&lt;-</span> encuesta_mrp <span class="sc">%&gt;%</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">yk_dir =</span> pobreza) <span class="sc">%&gt;%</span> </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">weights =</span> fexp)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>bynames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"area"</span>, <span class="st">"anoest"</span>, <span class="st">"edad"</span>, <span class="st">"discapacidad"</span>, <span class="st">"etnia"</span>)</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>plot_uni <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> <span class="fu">setNames</span>(bynames, bynames),</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> <span class="fu">plot_compare2</span>(</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_diseno =</span> diseno,</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">poststrat =</span> poststrat_df,</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">by1 =</span> .x</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>plot_uni <span class="ot">&lt;-</span> (plot_uni<span class="sc">$</span>area<span class="sc">$</span>Plot<span class="sc">$</span>plot1 <span class="sc">+</span> plot_uni<span class="sc">$</span>anoest<span class="sc">$</span>Plot<span class="sc">$</span>plot1)<span class="sc">/</span></span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>      (plot_uni<span class="sc">$</span>edad<span class="sc">$</span>Plot<span class="sc">$</span>plot1<span class="sc">+</span> plot_uni<span class="sc">$</span>discapacidad<span class="sc">$</span>Plot<span class="sc">$</span>plot1<span class="sc">+</span> plot_uni<span class="sc">$</span>etnia<span class="sc">$</span>Plot<span class="sc">$</span>plot1)</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>plot_uni</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA_fig/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="estimación-y-mapa-del-indicador-d6m." class="level2">
<h2 class="anchored" data-anchor-id="estimación-y-mapa-del-indicador-d6m.">Estimación y mapa del indicador D6m.</h2>
<p>Después de todos el proceso de estandarización, creación de variables covariables, estimación del modelo y validaciones realizadas, la estimación puntual se reduce a operaciones algebraicas simples.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-40_ed3a51bc75ab0e17bc522f7826f064a4">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>poststrat_df2 <span class="ot">&lt;-</span>  poststrat_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(anoest <span class="sc">!=</span> <span class="st">"99"</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>dat_mpio <span class="ot">&lt;-</span> poststrat_df2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(mpio) <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">Benchmarking_estimate =</span> <span class="fu">sum</span>(n <span class="sc">*</span> pobreza2) <span class="sc">/</span> <span class="fu">sum</span>(n),</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En este paso validamos que las estimaciones no superen el valor de 1 o sean menores o iguales a creo.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-41_973ed251522febbadac3c5d55959375c">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>dat_mpio <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">Validar =</span> <span class="fu">sum</span>(Benchmarking_estimate <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                                            Benchmarking_estimate <span class="sc">&lt;</span> <span class="dv">0</span>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table>
<thead>
<tr>
<th style="text-align:right;">
Validar
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>

</table>
</div>
</div>
<section id="mapas-para-el-indicador-d6m" class="level3">
<h3 class="anchored" data-anchor-id="mapas-para-el-indicador-d6m">Mapas para el indicador D6m</h3>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-42_48cc23a267ffaa2a662ac0fb97d20043">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>ShapeSAE <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"../Shape/PROVINCIAS.shp"</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>ShapeSAE <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">mpio =</span> IDPROV,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">nombre=</span> PROVINCIA</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>P1_ingresolp <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(ShapeSAE <span class="sc">%&gt;%</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">left_join</span>(dat_mpio,  <span class="at">by =</span> <span class="st">"mpio"</span>))</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>brks_lp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="dv">1</span>)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>)</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>Mapa_lp <span class="ot">&lt;-</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  P1_ingresolp <span class="sc">+</span> <span class="fu">tm_polygons</span>(</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Benchmarking_estimate"</span>,</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> brks_lp,</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"D6m"</span>,</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"-YlOrRd"</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="fu">tm_layout</span>(<span class="at">asp =</span> <span class="dv">0</span>)</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>Mapa_lp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA_fig/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="estimación-del-indicador-ni-necesidades-insatisfechas" class="level1">
<h1>Estimación del indicador NI (Necesidades Insatisfechas)</h1>
<p>Lectura de insumos</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-43_7a6db85c60ec412d6f51525f53ee0d72">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>encuesta_mrp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/UNFPA/NI/encuesta_mrp.rds"</span>) </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>statelevel_predictors_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/UNFPA/NI/statelevel_predictors_df.rds"</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>censo_mrp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/UNFPA/NI/censo_mrp.rds"</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/UNFPA/NI/fit_mrp_logit.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Por el proceso de estandarizado realizado es renombrado el indicador <em>necesInst</em> como <em>probreza</em>, el modelo conteplado para el indicador es:</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-44_0d970029918cd202f011338272c2bfc8">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">@</span>call</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>glmer(formula = cbind(pobres, nopobres) ~ (1 | mpio) + (1 | edad) + 
    (1 | area) + (1 | anoest) + (1 | etnia) + (1 | mpio:area) + 
    (1 | mpio:etnia) + (1 | mpio:edad) + (1 | mpio:anoest) + 
    (1 | area:edad) + (1 | etnia:edad) + (1 | etnia:anoest) + 
    (1 | edad:anoest) + (1 | discapacidad) + tasa_desocupacion + 
    stable_lights + crops.coverfraction + urban.coverfraction, 
    data = encuesta_df_agg, family = binomial(link = "logit"))</code></pre>
</div>
</div>
<p>El resultado del modelo es el siguiente.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-45_04be7abc27ebc51b47a7ef80ec1cd827">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>(<span class="fu">coef</span>(fit)<span class="sc">$</span>mpio <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> (Intercept) </th>
   <th style="text-align:right;"> tasa_desocupacion </th>
   <th style="text-align:right;"> stable_lights </th>
   <th style="text-align:right;"> crops.coverfraction </th>
   <th style="text-align:right;"> urban.coverfraction </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 0101 </td>
   <td style="text-align:right;"> -1.1370 </td>
   <td style="text-align:right;"> -2.5742 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0102 </td>
   <td style="text-align:right;"> -0.6228 </td>
   <td style="text-align:right;"> -2.5742 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0103 </td>
   <td style="text-align:right;"> -0.9597 </td>
   <td style="text-align:right;"> -2.5742 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0104 </td>
   <td style="text-align:right;"> -0.7229 </td>
   <td style="text-align:right;"> -2.5742 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0105 </td>
   <td style="text-align:right;"> -0.8627 </td>
   <td style="text-align:right;"> -2.5742 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0106 </td>
   <td style="text-align:right;"> -1.0516 </td>
   <td style="text-align:right;"> -2.5742 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0107 </td>
   <td style="text-align:right;"> -0.8951 </td>
   <td style="text-align:right;"> -2.5742 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0201 </td>
   <td style="text-align:right;"> -0.9095 </td>
   <td style="text-align:right;"> -2.5742 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0202 </td>
   <td style="text-align:right;"> -0.9693 </td>
   <td style="text-align:right;"> -2.5742 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0203 </td>
   <td style="text-align:right;"> -0.5424 </td>
   <td style="text-align:right;"> -2.5742 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<section id="predicción-en-el-censo-2" class="level3">
<h3 class="anchored" data-anchor-id="predicción-en-el-censo-2">Predicción en el censo</h3>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-46_46bc1db3c93c2642a4a209f171e6e5d3">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a> byAgrega <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"mpio"</span>, <span class="st">"area"</span>, <span class="st">"edad"</span>, <span class="st">"etnia"</span>,</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"anoest"</span>, <span class="st">"discapacidad"</span>, <span class="st">"unida"</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="ot">&lt;-</span> censo_mrp <span class="sc">%&gt;%</span>  </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">group_by_at</span>(byAgrega) <span class="sc">%&gt;%</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(n), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(poststrat_df, statelevel_predictors_df,</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">by =</span> <span class="st">"mpio"</span>)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>epred_mat <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> poststrat_df, </span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">allow.new.levels =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Validación de las predicciones</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-47_b3e65ce8a3e53dd16a06ae97a5fa2a16">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(epred_mat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(epred_mat <span class="sc">&lt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>Asignar la predicción a la base de <code>poststrat_df</code></p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-48_24699f97868227fdf50ae4542eeed2c0">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>poststrat_df<span class="sc">$</span>epred_mat <span class="ot">&lt;-</span> epred_mat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="benchmarking-1" class="level3">
<h3 class="anchored" data-anchor-id="benchmarking-1">Benchmarking</h3>
<ol type="1">
<li>Validarse los nombres de las covariables disponibles en censo y encuesta, que deben ser las mismas con las que se han venido trabajando, para este caso resultaron</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-49_06bfaaf4ee2691b640400e6d852f60db">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>names_cov <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"area"</span>, <span class="st">"edad"</span>, <span class="st">"etnia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Calcular las estimaciones para cada una de las variables de la base de datos de <code>encuesta_mrp</code> utilizando el indicador de interés.</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-50_3a94b38da3d6ae51047d9cc51d9da022">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>encuesta_mrp <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">pobreza =</span> necesInst)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>paso <span class="ot">&lt;-</span> <span class="fu">sapply</span>(names_cov, <span class="cf">function</span>(byi){</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    encuesta_mrp <span class="sc">%&gt;%</span> </span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by_at</span>(<span class="fu">all_of</span>(byi)) <span class="sc">%&gt;%</span> </span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">Nhat =</span> <span class="fu">sum</span>(fexp),</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">t_pobreza =</span> <span class="fu">sum</span>(pobreza<span class="sc">*</span>fexp),</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">medias =</span> <span class="fu">weighted.mean</span>(pobreza,fexp))</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>( Categoría <span class="ot">=</span> <span class="fu">unlist</span>(paso[<span class="st">"area"</span>,]),</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">Total =</span> <span class="fu">unlist</span>(paso[<span class="st">"t_pobreza"</span>,]),</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">Hat_Media =</span> <span class="fu">unlist</span>(paso[<span class="st">"medias"</span>,])) <span class="sc">%&gt;%</span> </span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tba</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:left;"> Categoría </th>
   <th style="text-align:right;"> Total </th>
   <th style="text-align:right;"> Hat_Media </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> area1 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:right;"> 48912.268 </td>
   <td style="text-align:right;"> 0.0375 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> area2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 158571.357 </td>
   <td style="text-align:right;"> 0.0275 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad1 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 9922.903 </td>
   <td style="text-align:right;"> 0.0075 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 58907.882 </td>
   <td style="text-align:right;"> 0.0285 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad3 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:right;"> 72982.138 </td>
   <td style="text-align:right;"> 0.0386 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad4 </td>
   <td style="text-align:left;"> 5 </td>
   <td style="text-align:right;"> 65670.702 </td>
   <td style="text-align:right;"> 0.0365 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> etnia1 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 51391.370 </td>
   <td style="text-align:right;"> 0.0299 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> etnia2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 23102.623 </td>
   <td style="text-align:right;"> 0.0279 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> etnia3 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 132989.632 </td>
   <td style="text-align:right;"> 0.0294 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<ol start="3" type="1">
<li>Crear variables dummys en <code>poststrat_df</code> y multiplicar cada variable por la predicción <code>epred_mat</code></li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-51_664dd9c4fe2538489f39693c974f0f4e">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  fastDummies<span class="sc">::</span><span class="fu">dummy_cols</span>(<span class="at">select_columns =</span> names_cov,</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">remove_selected_columns =</span> <span class="cn">FALSE</span>)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">matches</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d$"</span>)) ,<span class="sc">~</span>.<span class="sc">*</span>poststrat_df<span class="sc">$</span>epred_mat)</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tba</span>( poststrat_df <span class="sc">%&gt;%</span> <span class="fu">select</span>(names_cov,<span class="fu">matches</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d$"</span>)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> area </th>
   <th style="text-align:left;"> edad </th>
   <th style="text-align:left;"> etnia </th>
   <th style="text-align:right;"> area_0 </th>
   <th style="text-align:right;"> area_1 </th>
   <th style="text-align:right;"> edad_2 </th>
   <th style="text-align:right;"> edad_3 </th>
   <th style="text-align:right;"> edad_4 </th>
   <th style="text-align:right;"> edad_5 </th>
   <th style="text-align:right;"> etnia_1 </th>
   <th style="text-align:right;"> etnia_2 </th>
   <th style="text-align:right;"> etnia_3 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.0121 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0121 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0121 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.0151 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0151 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0151 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.0151 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0151 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0151 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.0132 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0132 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0132 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.0132 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0132 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0132 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.0132 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0132 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0132 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.0101 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0101 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0101 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 0.0151 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0151 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0151 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 0.0151 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0151 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0151 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 0.0132 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0132 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0132 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 0.0101 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0101 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0101 </td>
   <td style="text-align:right;"> 0.0000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.0121 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0121 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0121 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.0151 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0151 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0151 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.0151 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0151 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0151 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.0151 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0151 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0151 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.0151 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0151 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0151 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.0132 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0132 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0132 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.0132 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0132 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0132 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.0132 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0132 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0132 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.0132 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0132 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0000 </td>
   <td style="text-align:right;"> 0.0132 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<ol start="4" type="1">
<li>Con la función <code>calib</code> se procede a calcular los <span class="math inline">\(g_k\)</span>, verificando que el proceso se haya realizado con éxito y exista convergencia</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-52_b3d43e2b67f6913ea9993572cc47d3c9">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sampling)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>poststrat_df<span class="sc">$</span>gk <span class="ot">&lt;-</span> <span class="fu">calib</span>(</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Xs =</span> poststrat_df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d$"</span>)), <span class="do">## Variable dummys </span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> poststrat_df<span class="sc">$</span>n,                            <span class="do">## Conteos en el post-estrato</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">total =</span> <span class="fu">unlist</span>(paso[<span class="st">"t_pobreza"</span>,]),            <span class="do">## Valores objetivo</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">method=</span><span class="st">"logit"</span>)                                <span class="do">## Método empleado</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="fu">checkcalibration</span>(<span class="at">Xs =</span> poststrat_df <span class="sc">%&gt;%</span> </span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d$"</span>)), </span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">d =</span> poststrat_df<span class="sc">$</span>n,</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">total =</span> <span class="fu">unlist</span>(paso[<span class="st">"t_pobreza"</span>,]),</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">g =</span> poststrat_df<span class="sc">$</span>gk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$message
[1] "the calibration is done"

$result
[1] TRUE

$value
[1] 1e-06</code></pre>
</div>
</div>
<ol start="5" type="1">
<li>Realizar validación sobre los resultados obtenidos.</li>
</ol>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-53_db6180990605b2fbf33a5108ef87478a">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(poststrat_df<span class="sc">$</span>gk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA_fig/unnamed-chunk-53-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Continuando con la validación se define define la columna <code>pobreza2</code></p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-54_f59e3b724c4e84dbdb6454083e7d913c">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pobreza2 =</span> epred_mat <span class="sc">*</span>gk,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">pobreza2 =</span> <span class="fu">ifelse</span>(pobreza2<span class="sc">&gt;</span><span class="dv">1</span>, <span class="dv">1</span>, pobreza2),</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">pobreza2 =</span> <span class="fu">ifelse</span>(pobreza2<span class="sc">&lt;</span><span class="dv">0</span>, <span class="dv">0</span>, pobreza2)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Paso seguido realizamos el calculo de los totales calibrados.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-55_e712387318e76b136aed40d55262dc06">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">map_df</span>(names_cov ,<span class="sc">~</span> poststrat_df <span class="sc">%&gt;%</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by_at</span>(<span class="fu">all_of</span>(.x)) <span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">summarise</span>(</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">Nhat =</span> <span class="fu">sum</span>(n),</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">t_pobreza =</span> <span class="fu">sum</span>(n<span class="sc">*</span>pobreza2)) <span class="sc">%&gt;%</span> </span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">transmute</span>(</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">Cal_Media =</span> t_pobreza<span class="sc">/</span>Nhat,</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">Variable =</span> <span class="fu">paste0</span>(.x, <span class="fu">get</span>(.x) ))) </span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>( Categoría <span class="ot">=</span> <span class="fu">unlist</span>(paso[<span class="st">"area"</span>,]),</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">Hat_Media =</span> <span class="fu">unlist</span>(paso[<span class="st">"medias"</span>,])) <span class="sc">%&gt;%</span> </span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(temp) <span class="sc">%&gt;%</span> <span class="fu">tba</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:left;"> Categoría </th>
   <th style="text-align:right;"> Hat_Media </th>
   <th style="text-align:right;"> Cal_Media </th>
   <th style="text-align:left;"> Variable </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> area1 </td>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:right;"> 0.0375 </td>
   <td style="text-align:right;"> 0.0372 </td>
   <td style="text-align:left;"> area0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> area2 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.0275 </td>
   <td style="text-align:right;"> 0.0274 </td>
   <td style="text-align:left;"> area1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad1 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 0.0075 </td>
   <td style="text-align:right;"> 0.0075 </td>
   <td style="text-align:left;"> edad2 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad2 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.0285 </td>
   <td style="text-align:right;"> 0.0284 </td>
   <td style="text-align:left;"> edad3 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad3 </td>
   <td style="text-align:left;"> 4 </td>
   <td style="text-align:right;"> 0.0386 </td>
   <td style="text-align:right;"> 0.0385 </td>
   <td style="text-align:left;"> edad4 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> edad4 </td>
   <td style="text-align:left;"> 5 </td>
   <td style="text-align:right;"> 0.0365 </td>
   <td style="text-align:right;"> 0.0364 </td>
   <td style="text-align:left;"> edad5 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> etnia1 </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:right;"> 0.0299 </td>
   <td style="text-align:right;"> 0.0297 </td>
   <td style="text-align:left;"> etnia1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> etnia2 </td>
   <td style="text-align:left;"> 2 </td>
   <td style="text-align:right;"> 0.0279 </td>
   <td style="text-align:right;"> 0.0278 </td>
   <td style="text-align:left;"> etnia2 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> etnia3 </td>
   <td style="text-align:left;"> 3 </td>
   <td style="text-align:right;"> 0.0294 </td>
   <td style="text-align:right;"> 0.0293 </td>
   <td style="text-align:left;"> etnia3 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>También es posible hacer validaciones visuales.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-56_3687569602f5f7f535fadc0ba027ed16">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"0Recursos/0Funciones/funciones_mrp.R"</span>)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">yk_lmer =</span> epred_mat, </span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">yk_bench =</span> pobreza2)</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>diseno <span class="ot">&lt;-</span> encuesta_mrp <span class="sc">%&gt;%</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">yk_dir =</span> pobreza) <span class="sc">%&gt;%</span> </span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">weights =</span> fexp)</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>bynames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"area"</span>, <span class="st">"anoest"</span>, <span class="st">"edad"</span>, <span class="st">"discapacidad"</span>, <span class="st">"etnia"</span>)</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>plot_uni <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> <span class="fu">setNames</span>(bynames, bynames),</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> <span class="fu">plot_compare2</span>(</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_diseno =</span> diseno,</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">poststrat =</span> poststrat_df,</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">by1 =</span> .x</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>plot_uni <span class="ot">&lt;-</span> (plot_uni<span class="sc">$</span>area<span class="sc">$</span>Plot<span class="sc">$</span>plot1 <span class="sc">+</span> plot_uni<span class="sc">$</span>anoest<span class="sc">$</span>Plot<span class="sc">$</span>plot1)<span class="sc">/</span></span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>      (plot_uni<span class="sc">$</span>edad<span class="sc">$</span>Plot<span class="sc">$</span>plot1<span class="sc">+</span> plot_uni<span class="sc">$</span>discapacidad<span class="sc">$</span>Plot<span class="sc">$</span>plot1<span class="sc">+</span> plot_uni<span class="sc">$</span>etnia<span class="sc">$</span>Plot<span class="sc">$</span>plot1)</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>plot_uni</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA_fig/unnamed-chunk-56-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="estimación-y-mapa-del-indicador.-1" class="level2">
<h2 class="anchored" data-anchor-id="estimación-y-mapa-del-indicador.-1">Estimación y mapa del indicador.</h2>
<p>Después de todos el proceso de estandarización, creación de variables covariables, estimación del modelo y validaciones realizadas, la estimación puntual se reduce a operaciones algebraicas simples.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-57_7eb23b7b43b5f8f0ea5d6fc4d6cee6ab">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>poststrat_df2 <span class="ot">&lt;-</span>  poststrat_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(anoest <span class="sc">!=</span> <span class="st">"99"</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>dat_mpio <span class="ot">&lt;-</span> poststrat_df2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(mpio) <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">Benchmarking_estimate =</span> <span class="fu">sum</span>(n <span class="sc">*</span> pobreza2) <span class="sc">/</span> <span class="fu">sum</span>(n),</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En este paso validamos que las estimaciones no superen el valor de 1 o sean menores o iguales a creo.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-58_957727711952bd5bb01487c2a7cee56a">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>dat_mpio <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">Validar =</span> <span class="fu">sum</span>(Benchmarking_estimate <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>                                            Benchmarking_estimate <span class="sc">&lt;</span> <span class="dv">0</span>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table>
<thead>
<tr>
<th style="text-align:right;">
Validar
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>

</table>
</div>
</div>
<section id="mapas-para-el-indicador-ni" class="level3">
<h3 class="anchored" data-anchor-id="mapas-para-el-indicador-ni">Mapas para el indicador NI</h3>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-59_cef8af14032312006526c0573b6d4338">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>ShapeSAE <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"../Shape/PROVINCIAS.shp"</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>ShapeSAE <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">mpio =</span> IDPROV,</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">nombre=</span> PROVINCIA</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>P1_ingresolp <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(ShapeSAE <span class="sc">%&gt;%</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">left_join</span>(dat_mpio,  <span class="at">by =</span> <span class="st">"mpio"</span>))</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>brks_lp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="fl">0.03</span>, <span class="fl">0.04</span>, <span class="fl">0.05</span>, <span class="fl">0.06</span>, <span class="dv">1</span>)</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>)</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>Mapa_lp <span class="ot">&lt;-</span></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>  P1_ingresolp <span class="sc">+</span> <span class="fu">tm_polygons</span>(</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Benchmarking_estimate"</span>,</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> brks_lp,</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"NI"</span>,</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"YlOrRd"</span></span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="fu">tm_layout</span>(<span class="at">asp =</span> <span class="dv">0</span>)</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>Mapa_lp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA_fig/unnamed-chunk-59-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="estimación-del-indicador-d7" class="level1">
<h1>Estimación del indicador D7</h1>
<p>Este indicador, hace referencia a la proporción de mujeres en edad de procrear (15 a 49 años), sexualmente activas y/o unidas que han decidido por voluntad propia no tener hijos (adicionales) o posponer su siguiente hijo y para ello se encuentran utilizando métodos anticonceptivos modernos.</p>
<p>Lectura de insumos</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-60_ca0d5e7c8e7c20d0430fa16d19634540">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>encuesta_mrp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/UNFPA/NI/encuesta_mrp.rds"</span>) </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>censo_mrp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/UNFPA/NI/censo_mrp.rds"</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>statelevel_predictors_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/UNFPA/NI/statelevel_predictors_df.rds"</span>)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>fit_mrp_logit_D6  <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/UNFPA/D6/fit_mrp_logit.rds"</span>)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>fit_mrp_logit_D6m <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/UNFPA/D6m/fit_mrp_logit.rds"</span>)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>fit_mrp_logit_NI  <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Data/UNFPA/NI/fit_mrp_logit.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="predicción-en-el-censo-3" class="level3">
<h3 class="anchored" data-anchor-id="predicción-en-el-censo-3">Predicción en el censo</h3>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-61_d7356a382de96cb85a80f5f66423e3fa">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>byAgrega <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"mpio"</span>, <span class="st">"area"</span>, <span class="st">"edad"</span>, <span class="st">"etnia"</span>,</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"anoest"</span>, <span class="st">"discapacidad"</span>, <span class="st">"unida"</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="ot">&lt;-</span> censo_mrp <span class="sc">%&gt;%</span>  </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">group_by_at</span>(byAgrega) <span class="sc">%&gt;%</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(n), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>poststrat_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(poststrat_df, statelevel_predictors_df,</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">by =</span> <span class="st">"mpio"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ahora debemos hacer la predicción sobre la base <em>poststrat_df</em> con los tres modelos</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-62_d831c3d37393584e4fd8627bfe2adb08">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Creando epredmat Para D6</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>epred_mat_D6 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_mrp_logit_D6, <span class="at">newdata =</span> poststrat_df, </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">allow.new.levels =</span> <span class="cn">TRUE</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="do">### Creando epredmat Para D6m</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>epred_mat_D6m <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_mrp_logit_D6m, <span class="at">newdata =</span> poststrat_df, </span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">allow.new.levels =</span> <span class="cn">TRUE</span>)</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="do">### Creando epredmat Para NI</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>epred_mat_NI <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_mrp_logit_NI, <span class="at">newdata =</span> poststrat_df, </span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">allow.new.levels =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El indicador <em>D7</em> se construye a partir de las predicciones</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-63_31f0b015de2fe8f2c9a43a5ca735aa58">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>epred_mat_D7<span class="ot">&lt;-</span> (epred_mat_D6m<span class="sc">/</span>(epred_mat_D6 <span class="sc">+</span> epred_mat_NI))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Asignar la predicción a la base de <code>poststrat_df</code></p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-64_db50d56b002bd3cec866b950217fa534">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>poststrat_df<span class="sc">$</span>epred_mat <span class="ot">&lt;-</span> epred_mat_D7</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="estimación-y-mapa-del-indicador.-2" class="level2">
<h2 class="anchored" data-anchor-id="estimación-y-mapa-del-indicador.-2">Estimación y mapa del indicador.</h2>
<p>Después de todos el proceso de estandarización, creación de variables covariables, estimación del modelo y validaciones realizadas, la estimación puntual se reduce a operaciones algebraicas simples.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-65_570ce9e8f02e5483d47f1c515a3e3a8a">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>poststrat_df2 <span class="ot">&lt;-</span>  poststrat_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(anoest <span class="sc">!=</span> <span class="st">"99"</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>dat_mpio <span class="ot">&lt;-</span> poststrat_df2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(mpio) <span class="sc">%&gt;%</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">Benchmarking_estimate =</span> <span class="fu">sum</span>(n <span class="sc">*</span> epred_mat) <span class="sc">/</span> <span class="fu">sum</span>(n),</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En este paso validamos que las estimaciones no superen el valor de 1 o sean menores o iguales a creo.</p>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-66_eb464a2f1445f81721bf0f900fe07bbf">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>dat_mpio <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">Validar =</span> <span class="fu">sum</span>(Benchmarking_estimate <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>                                            Benchmarking_estimate <span class="sc">&lt;</span> <span class="dv">0</span>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table>
<thead>
<tr>
<th style="text-align:right;">
Validar
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>

</table>
</div>
</div>
<section id="mapas-para-el-indicador-d7" class="level3">
<h3 class="anchored" data-anchor-id="mapas-para-el-indicador-d7">Mapas para el indicador D7</h3>
<div class="cell" data-hash="0Recursos/5.0Modelos_UNFPA/unnamed-chunk-67_819346db21461a999a44d1dca76fd596">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>ShapeSAE <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"../Shape/PROVINCIAS.shp"</span>)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>ShapeSAE <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">mpio =</span> IDPROV,</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">nombre=</span> PROVINCIA</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>P1_ingresolp <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(ShapeSAE <span class="sc">%&gt;%</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">left_join</span>(dat_mpio,  <span class="at">by =</span> <span class="st">"mpio"</span>))</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>brks_lp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.20</span>,  <span class="fl">0.4</span>, <span class="fl">0.6</span>,  <span class="fl">0.8</span> , <span class="dv">1</span>)</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>)</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>Mapa_lp <span class="ot">&lt;-</span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>  P1_ingresolp <span class="sc">+</span> <span class="fu">tm_polygons</span>(</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Benchmarking_estimate"</span>,</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> brks_lp,</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"D7"</span>,</span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"-YlOrRd"</span></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="fu">tm_layout</span>(<span class="at">asp =</span> <span class="dv">0</span>)</span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>Mapa_lp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="0Recursos/5.0Modelos_UNFPA_fig/unnamed-chunk-67-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>